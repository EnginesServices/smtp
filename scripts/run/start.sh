#!/bin/sh

PID_FILE=/tmp/sleep.pid\r\nexport PID_FILE\r\n\r\nKILL_SCRIPT=/home/engines/scripts/signal/kill_sleep.sh\r\nexport KILL_SCRIPT\r\n\r\n. /home/engines/functions/trap.sh\r\n\r\nservice_first_run_check\r\n\r\n\r\n\r\nsudo -n /home/engines/scripts/startup/sudo/start.sh prepare\r\n\r\nsudo -n /home/engines/scripts/startup/sudo/start.sh start\r\nr=$?\r\n\r\nif test $r -eq 0\r\n then\r\n    startup_complete\r\n\tsleep 5\t\r\n else\r\n sleep 300\r\n  echo \"Failed with $r\"\r\n  exit $r\t  \r\nfi\r\n\r\n\r\nwhile ! test -f /home/engines/run/flags/sig_term -o -f /home/engines/run/flags/sig_quit\r\n do \t\t\r\n\t if ! test -f /var/spool/postfix/pid/master.pid\r\n\t  then\r\n\t   echo Exit as master pid file missing \r\n\t   break\r\n\t fi\r\n    sleep 120 &\r\n    echo $! >/tmp/sleep.pid\r\n\twait \t\t\r\n\texit_code=$?\t\t\r\ndone\t\r\n\r\n\r\n/home/engines/scripts/signal/kill_sleep.sh\r\n\r\nshutdown_complete\r\n\r\nsleep 200
